---
title: "Project 1 - Exploratory Data Analysis in R"
author: "Łukasz Kobyłecki (127292), Tomasz Gil (127295)"
date: "2-12-2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

This is a report from project "Exploratory Data Analysis" in R. It consists of the following sections:

* Introduction
* Preprocessing
* Data summary
* Univariate analysis
* Multivariate analysis
* Conclusions

## Data description
We have used a data set from Kaggle, available under the following link:
https://www.kaggle.com/kemical/kickstarter-projects?fbclid=IwAR2xYRsLXeEKvpLpuQ7ONYRzUZsg5keYoskL6BGS29Do1f5tscFmcv40szo.

The data set aggregates information about most recent Kickstarter projects. Kickstarter is an crowdfunding website with projects of various size. Within the data set we have access to following attributes:

* ID: internal kickstarter id 
* name: name of project - a project is a finite work with a clear goal that you’d like to bring to life (albums, books, or films) 
* category: category 
* main_category: category of campaign 
* currency: currency used to support 
* deadline: deadline for crowdfunding 
* goal: fundraising goal - the funding goal is the amount of money that a creator needs to complete their project 
* launched: date launched 
* pledged: amount pledged by "crowd" 
* state: Current condition the project is in 
* backers: number of backers 
* country: country pledged from 
* usd pledged: amount of money pledged Goal amount in USD


## Preprocessing

First of all, we have to import packages.
```{r message = FALSE, warning = FALSE}
library("dplyr")
library("ggplot2")
library("scales")
library("Hmisc")
```

Then we read file and show sample data.
```{r}
data <- read.csv(file="data/ks-projects.csv", header=TRUE, sep=",")
head(data, 3)
```

There are some columns, which are not necessary for the purpose of this analysis. 
```{r}
colnames(data)
```

Then we have to check if all data is correct. We check if there are NA values.
```{r}
for (i in colnames(data)) {
  print(paste(i, ": ", length(na.omit(data$main_category)), "/", length(data$main_category), sep = ""))
}
```

Now we have to check if data is valid in all columns.
1. There are a lot of categories with just a few projects for each of them.
```{r}
as.vector(table(data$main_category))[1:30]
```

2. There are some invalid date values in 'deadline' columns.
```{r}
is.date <- function(x) !is.na(as.Date(x, format="%Y-%m-%d"))

deadlineDates <- as.character(factor(unique(data$deadline)))
deadlineDates[!is.date(deadlineDates)][1:10]
```

3. There are some invalid date values in 'launched' columns.
```{r}
launchedDates <- as.character(factor(unique(data$launched)))
launchedDates[!is.date(launchedDates)][1:10]
```

4. There are also many states which are either not valid or do not provide information needed for the purpose of this analysis.
```{r}
factor(unique(data$state))[1:20]
```

5. There are some invalid 'goal' values.
```{r warning = FALSE}
x <- as.character(factor(data$goal))
x[is.na(as.double(x))][1:10]
```

6. There are some invalid 'pledged' values.
```{r warning = FALSE}
x <- as.character(factor(data$pledged))
x[is.na(as.double(x))][1:10]
```

7. There are some invalid 'backers' values.
```{r warning = FALSE}
x <- as.character(factor(data$backers))
x[is.na(as.integer(x))][1:10]
```

Now we check the number of rows before preprocessing for reference.
```{r}
nrow(data)
```

Now we perform the preprocessing.
```{r}
data <- data %>% 
  select(4:11) %>% 
  select(-2)
data <- data[, c(1, 3, 5, 7, 6, 4, 2)]

categoryFrequency <- as.list(table(data$main_category))
data <- data %>% 
  filter(categoryFrequency[main_category] > 100)

data <- data %>% 
  filter(is.date(deadline) & is.date(launched)) %>%
  filter(format(as.Date(launched), "%Y") > 2000)

data <- data %>% 
  filter(state == "canceled" | 
           state == "failed" |
           state == "successful")

data <- data %>%
  filter(!is.na(as.double(as.character(goal))))

data <- data %>%
  filter(!is.na(as.double(as.character(pledged))))

data <- data %>%
  filter(!is.na(as.integer(as.character(backers))))
```

Now we can check the number of rows after preprocessing.
```{r}
nrow(data)
```

As we see, we decreased the number of rows in the data. Now we have only neccessary columns which we also reordered.
```{r}
colnames(data)
```

This is how 'main_category' column looks like. Now there are only those categories we want to analyze.
```{r}
table(droplevels(data$main_category))
```

There is no more invalid data in the 'deadline' column.
```{r}
deadlineDates <- as.character(factor(unique(data$deadline)))
deadlineDates[!is.date(deadlineDates)]
```

There is no more invalid data in the 'launched' column.
```{r}
launchedDates <- as.character(factor(unique(data$launched)))
launchedDates[!is.date(launchedDates)]
```

This is how 'state' column looks like. There are only states we want to analyze.
```{r}
table(droplevels(data$state))
```

There is no more invalid data in the 'goal' column.
```{r}
x <- as.character(factor(data$goal))
x[is.na(as.double(x))]
```

There is no more invalid data in the 'pledged' column.
```{r}
x <- as.character(factor(data$pledged))
x[is.na(as.double(x))]
```

There is no more invalid data in the 'backers' column.
```{r}
x <- as.character(factor(data$backers))
x[is.na(as.integer(x))]
```

The last thing to do is to convert all columns to a valid data type.
```{r}
data$main_category <- as.factor(data$main_category)
data$goal <- as.double(data$goal)
data$deadline <- as.Date(data$deadline)
data$launched <- as.Date(data$launched)
data$pledged <- as.double(data$pledged)
data$backers <- as.double(data$backers)
```

## Data summary

First we take a look at the structure and content of first few rows in our data set after preprocessing.
```{r}
head(data)
```

Then we can proceed to a general summary. Most of the features are sufficiently explained in general summary.
```{r}
summary(data)
```

More detailed summary might be useful for 'main_category' column.
```{r}
summary(droplevels(data$main_category))
```

## Univariate analysis

First element of the examination is univatiate analysis, where we check the crutial features with regards to their distribution and general basic statisticts. Having said so, the results presented in this section are self-explanatory.

### Projects by category
```{r}
data %>%
  group_by(main_category) %>%
  summarise(projects = n()) %>%
  arrange(projects) %>%
  with(barplot(projects, names.arg = main_category, xlab = "categories", ylab = "projects", main = "Projects by category", las = 2))
```

### Projects by year
```{r}
data %>%
  mutate(year = as.integer(format(launched, "%Y"))) %>%
  group_by(year) %>%
  summarise(projects = n()) %>%
  arrange(year) %>%
  with(plot(year, projects, type = "o", main = "Projects by year"))
```

### Projects by month
```{r}
data %>%
  mutate(month = format(launched, "%m")) %>%
  group_by(month) %>%
  summarise(projects = n()) %>%
  arrange(month) %>%
  with(barplot(projects, names.arg = month, xlab = "months", ylab = "projects", main = "Projects by month"))
```

### Projects by state
```{r}
data %>%
  group_by(state) %>%
  summarise(projects = n()) %>%
  arrange(desc(projects)) %>%
  with(pie(projects, state, col = rainbow(length(projects)), main = "Projects by state"))
```

### Goal amount boxplot
```{r}
boxplot(data$goal, ylab = "goal", main = "Goal amount boxplot")
```

### Projects by goal amount
```{r}
hist(data$goal, xlab = "goal", ylab = "projects", main = "Projects by goal amount", col = "grey")
```

### Pledged amount boxplot
```{r}
boxplot(data$pledged, ylab = "pledged", main = "Pledged amount boxplot")
```

### Projects by pledged amount
```{r}
hist(data$pledged, xlab = "pledged", ylab = "projects", main = "Projects by pledged amount", col = "grey")
```

### Backers number boxplot
```{r}
boxplot(data$backers, ylab = "backers", main = "Backers number boxplot")
```

### Projects by backers number
```{r}
hist(data$backers, xlab = "backers", ylab = "projects", main = "Projects by backers number", col = "grey")
```

## Multivariate analysis

Now we will take a closer look at the data, taking into consideration two or more features at the time, so that we can observe trends and dependencies.

### Project state by category
```{r}
data %>%
  group_by(main_category) %>%
  summarise(sucessfull = sum(state == "successful"),
            failed = sum(state == "failed"),
            canceled = sum(state == "canceled"),
            success_rate = round(sum(state == "successful") / n(), digits = 2),
            failed_rate = round(sum(state == "failed") / n(), digits = 2),
            canceled_rate = round(sum(state == "canceled") / n(), digits = 2))
```

```{r}
plot1 <- data %>%
  group_by(main_category, state) %>%
  summarise(count = n()) %>%
  mutate(percentage = count / sum(count), label = scales::percent(percentage))

ggplot(plot1, aes(x = factor(main_category, levels = levels(plot1$main_category)), 
                  y = percentage,
                  fill = factor(state, levels = levels(plot1$state)))) +
  geom_bar(stat = "identity", position = "fill") + 
  scale_y_continuous(breaks = seq(0, 1, 0.2), labels = paste(seq(0, 100, 20), "%", sep = "")) +
  geom_text(aes(label = label), size = 3, position = position_stack(vjust = 0.5)) +
  scale_fill_manual(values = c("successful" = "green", "failed" = "red", "canceled" = "blue")) +
  labs(y = "Percent", fill = "State", x = "Category", title = "Project state by category") +
  theme(axis.text.x = element_text(angle = 290, hjust = 0, vjust = 0.5))
```

First we took a look at the number of successful, failed and canceled projects for each category. This gives us an insight into what is the rate of successful and unsuccessful projects with respect to project category. Moreover, those values can give an information about the probability that a project in given category will suceeed.

We can see that projects associated with Dance and Theater categories have the highest, more that 60% chance of success. On the other end of the spectrum we have technology projects with just over 20% chance of success, which is probably both higly competitive and saturated industry with crowdfunded projects recently. Also high chance of failure have projects related to Journalism, Crafts and Fashion. Interestingly, Game projects have the highest chance of getting cancelled.

### Project state by year
```{r}
data %>%
  mutate(year = as.integer(format(launched, "%Y"))) %>%
  group_by(year) %>%
  summarise(sucessfull = sum(state == "successful"),
            failed = sum(state == "failed"),
            canceled = sum(state == "canceled"),
            success_rate = round(sum(state == "successful") / n(), digits = 2),
            failed_rate = round(sum(state == "failed") / n(), digits = 2),
            canceled_rate = round(sum(state == "canceled") / n(), digits = 2)) %>%
  arrange(year)
```

```{r}
plot2 <- data %>%
  mutate(year = as.integer(format(launched, "%Y"))) %>%
  group_by(year, state) %>%
  summarise(count = n()) %>%
  mutate(percentage = count / sum(count), label = scales::percent(percentage)) %>%
  arrange(year)

ggplot(plot2, aes(x = year, y = percentage)) +
  geom_line(aes(color = state)) + 
  scale_color_manual(values = c("successful" = "green", "failed" = "red", "canceled"="blue")) + 
  scale_y_continuous(breaks = seq(0, 1, 0.2), labels = paste(seq(0, 100, 20), "%", sep = "")) +
  labs(y = "Percent", fill = "State", x = "Year", title = "Project state by year") + 
  theme_minimal()
```

We can also observe how projects states changed over time, which can give us information on both the performance of the platform, good preparation and execution of the projects and overall interest in such form of projects support.
We can quite clearly see changing trends, with the most notable raise in the number of unsuccessful projects up until the year 2015, to almost 60%. There has also been a gradual increase in the number of cancelled projects.

Overall, we can claim that in the years 2009-2016 probably the best time to start a crowdfunding project on Kickstarter was year 2011, where there wa roughly 50% chance for success as well as for the failure.

### Project state by month
```{r}
data %>%
  mutate(month = as.integer(format(launched, "%m"))) %>%
  group_by(month) %>%
  summarise(sucessfull = sum(state == "successful"),
            failed = sum(state == "failed"),
            canceled = sum(state == "canceled"),
            success_rate = round(sum(state == "successful") / n(), digits = 2),
            failed_rate = round(sum(state == "failed") / n(), digits = 2),
            canceled_rate = round(sum(state == "canceled") / n(), digits = 2)) %>%
  arrange(month)
```

```{r}
plot3 <- data %>%
  mutate(month = as.integer(format(launched, "%m"))) %>%
  group_by(month, state) %>%
  summarise(count = n()) %>%
  mutate(percentage = count / sum(count), label = scales::percent(percentage)) %>%
  arrange(month)

ggplot(plot3, aes(x = month, y = percentage)) +
  geom_line(aes(color = state)) + 
  scale_color_manual(values = c("successful" = "green", "failed" = "red", "canceled" = "blue")) + 
  scale_y_continuous(breaks = seq(0, 1, 0.2), labels = paste(seq(0, 100, 20), "%", sep = "")) +
  labs(y = "Percent", fill = "State", x = "Month", title = "Project state by month") + 
  theme_minimal()
```

An interesing information can also be extracted while examining the projects' states for each month. The highest changes of project failure falls into holiday months - summer's June, July and August and winter's December and February.

### Goal amount by category and state
```{r}
ggplot(data, aes(x = main_category, y = goal, fill = state)) +
  geom_boxplot() + 
  labs(fill = "Goal") + 
  labs(y = "goal", fill = "state", x = "category", title = "Goal amount by category and state") + 
  theme(axis.text.x = element_text(angle = 290, hjust = 0, vjust = 0.5))
```

Next, we wanted to see if there is any correlation between project category and the disctibution of goal, which is the amount of money project owner would like to gather. As we can see, values across most of the categories are uniorm with a few exceptions when it comes to median value.

### Pledged amount by category and state
```{r}
ggplot(data, aes(x = main_category, y = pledged, fill = state)) +
  geom_boxplot() + 
  labs(fill = "Pledged") + 
  labs(y = "pledged", fill = "state", x = "category", title = "Pledged amount by category and state") + 
  theme(axis.text.x = element_text(angle = 290, hjust = 0, vjust = 0.5))
```

Contrary to the previous chart, we can see certain dependencies on this one. First thing is that, naturally, successful projects have highest pledged amounts, followed by failed and cancelled projects. We can observe that across all categories.

Looking deeper, typically here is a significant difference between the median for projects that have been cancelled and have failed. Exceptions to that rule would be Technology, Games and Design, where the distributions of pledged amout for cancelled and failed projects overlap. Design is the most interesing category amongs all in this regard, because as we can see on the chart, there is very little dependence in projects status on the amount that has actually been raised by the project owner.


### Backers number by category and state
```{r}
ggplot(data, aes(x = main_category, y = backers, fill = state)) +
  geom_boxplot() + 
  labs(fill = "Backers") + 
  labs(y = "Backers", fill = "state", x = "category", title = "Backers number by category and state") + 
  theme(axis.text.x = element_text(angle = 290, hjust = 0, vjust = 0.5))
```

Similar conclusions can be drawn from comparing the backers amount for each category with regards to the number of backers - people that made a donation for a project. As we can see, Technology, Games and Design have very similar distribution when it comes to failed and successful projects. For the remaining categories, based on the fact that the median bakers number for cancelled projects is 0 (or rather close to 0 for a few of those), we can assume that that was the reason for for cancelling those projects.

### Project state by goal amount 
```{r}
getGroupNumber <- function(x) {
  sapply(x, function(x) {
    if      (x >= 0    & x < 1255) return(0)
    else if (x >= 1255 & x < 3245) return(1)
    else if (x >= 3245 & x < 4635) return(2)
    else if (x >= 4635 & x < 5823) return(3)
    else                           return(4)
  })
}

plot5 <- data %>%
  mutate(bin = as.factor(getGroupNumber(goal))) %>%
  group_by(bin, state) %>%
  summarise(count = n()) %>%
  mutate(percentage = count / sum(count), label = scales::percent(percentage))

ggplot(plot5, aes(x = factor(bin, levels = levels(plot5$bin), labels = levels(cut2(data$goal, g = 5))), 
                  y = percentage,
                  fill = factor(state, levels = levels(plot5$state)))) +
  geom_bar(stat = "identity", position = "fill") + 
  scale_y_continuous(breaks = seq(0, 1, 0.2), labels = paste(seq(0, 100, 20), "%", sep = "")) +
  geom_text(aes(label = label), size = 3, position = position_stack(vjust = 0.5)) +
  scale_fill_manual(values = c("successful" = "green", "failed" = "red", "canceled" = "blue")) +
  labs(y = "Percent", fill = "State", x = "Goal amount", title = "Project state by goal amount")
```

As the last thing, we decided to examine if we there is any relation between the project goal and the state (for instace if projects with lower goal had a higher chance of success or not). As we can see, correlation between the project state and the goal isn't apparent.


